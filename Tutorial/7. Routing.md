# 7. Routing
In this part of the tutorial you will learn how to navigate users with use of MapBox routing Apis. MapBox provides sandbox where you can try navigation. This playground has great UI and you can learn to work with it there, so we will not build new part of Angular application to try this, since we can do that there.
## 7.1 Directions API
You can find [Directions API here](https://docs.mapbox.com/playground/directions). You can see list of parameters you can modify on the left side. You need to set your access token on the top. This is the same token we are using for map in Angular application. You can set the following:
- Coordinates: first coordinates are the start, and second are the destination.
- Routing profile: traffic for public transport, driving for vehicles, walking and cycling.
- Engine (optional): standard or electric. Selecting electric adds big list of parameters where you can configure the car to provide route with chargers in needed intervals based on battery capacity and power consumption.
- Depart at (optional): sets time of expected departure. This can be helpful to get more accurate estimate of travel time because it can be different at the time of expected departure and at the time of making the request.
- Exclude (optional): you can exclude toll, use only cash tolls, motorway, ferry, unpaved roads.
- Continue straight: keep going straight to minimize turns if distance or time isn't significantly different.
- Annotations: annotations in directions description. What you select here will be added to the list of written navigation steps.
- Notifications: warnings about current situation on road.
At the bottom under the map you can see your request. It will look like this:  
```rest
GET: https://api.mapbox.com/directions/v5/mapbox/driving/-74.184469%2C40.782292%3B-74.077327%2C40.81656?
alternatives=false&
geometries=geojson&
language=en&overview=full&
steps=true&
access_token=pk.eyJ1IjoicGFzdG8iLCJhIjoiY2pvc3YxOHN1MHV1ZjN3cGIwNWE4aHJjcCJ9.EPBhG_sqvQXtdwGkgXlxvA
```
Then you can see the result on map. There is also Response tab under map.
![image](https://github.com/dpastierovic/Geospatial-Application/assets/18383754/be57ab53-fa09-414d-9c7f-30d77c7969f1)  
The response is big json that contains array of possible routes if there are multiple. Each route contains legs. Route is split by each additional waypoint added by user between start and destination, and these splits are called legs. Each leg contains list of written instructions how to turn on intersections, warning about danger, length, estimated duration etc. And then if you want to display this on your map there is also geojson with line that can be displayed for navigation.
## 7.2 Traveling salesman problem
This is old problem. Salesman wants to pick up goods from warehouse and visit all shops to sell all goods. Time is money, so he wants to find shortest path that starts at warehouse, visits all shops, and returns to warehouse. This is NP-hard problem (non-deterministic polynomial-time hardness), which means time requirements ramp steeply with each added point. Best algorithms we have for this problem are still reliant to try out every possiblity, with greedy optimizations where you can cut obviously bad options early and not continue with computation for them. MapBox has [Optimization playground](https://demos.mapbox.com/optimization-v2-playground/) for solving this problem. You can add pickup locations (warehouse from traveling salesman problem) and dropoff locations (shops) up to 20. This limitation is there because it is NP-hard and you could easily overwhelm server with few big requests. They have great documentation how to use it [here](https://docs.mapbox.com/api/navigation/optimization/).
## 7.3 Isochrone API
[Isochrone Api](https://docs.mapbox.com/playground/isochrone/) can be used to show areas that are accessible by selected type of transport within given time:  
![image](https://github.com/dpastierovic/Geospatial-Application/assets/18383754/52398518-3b93-426c-9986-2ea948ab5650)
## 7.4 MapMatching API
[MapMatching API](https://docs.mapbox.com/help/tutorials/get-started-map-matching-api/) can be used to map inaccurate GPS recorded routes to most likely route they actually took. GPS accuracy can decrease in cities next to high building, in tunnels, narrow valleys and similar places which obstruct sky view. If you want to create route heatmap then heatmap will be more precise if you map it to actual routes that exist, not some random imprecise recordings that go trough the river instead trough the bridge where the car actually travel.
## 7.5 Summary
With the use of these Apis you have powerful toolbox to use in your application with simple REST requests. All the heavy lifting coding and optimizing the algorithms, keeping maps and realtime traffic data is done by the api.
